#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Function to split string by a given delimiter
char** split(char *str, char delim, int *count) {
    char **tokens = NULL;   // array of strings
    *count = 0;

    int start = 0;          // start index of a token
    int len = strlen(str);

    for (int i = 0; i <= len; i++) {
        // If current char is delimiter or end of string
        if (str[i] == delim || str[i] == '\0') {
            int tokenLength = i - start;

            // Allocate memory for the new token (+1 for null terminator)
            char *token = (char *)malloc((tokenLength + 1) * sizeof(char));
            if (token == NULL) {
                printf("Memory allocation failed!\n");
                exit(1);
            }

            strncpy(token, &str[start], tokenLength);
            token[tokenLength] = '\0';

            // Add token to array using realloc
            tokens = (char **)realloc(tokens, (*count + 1) * sizeof(char *));
            if (tokens == NULL) {
                printf("Memory reallocation failed!\n");
                exit(1);
            }
            tokens[*count] = token;
            (*count)++;

            start = i + 1; // move start to next token
        }
    }

    return tokens;
}

int main() {
    char str[100];
    char delim;
    int count;

    printf("Enter a string: ");
    fgets(str, sizeof(str), stdin);
    str[strcspn(str, "\n")] = '\0';  // remove newline

    printf("Enter delimiter: ");
    scanf(" %c", &delim);

    char **result = split(str, delim, &count);

    printf("\nTokens:\n");
    for (int i = 0; i < count; i++) {
        printf("[%d] %s\n", i + 1, result[i]);
        free(result[i]); // free each token
    }

    free(result); // free array of pointers
    return 0;
}
